{% if display == "html" %}
{% extends "brs_layout.html" %}
{% else %}
<title>Consolidated BRS</title>
<style>
    @page {
        size: landscape legal;
        margin: 1cm;
    }
</style>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bulma/css/bulma.css') }}" />
{% endif %}
{% block content %}
{% if (current_user.user_type == "ro_user" and current_user.ro_code == brs_month.uiic_regional_code) or
(current_user.user_type == "oo_user" and current_user.oo_code == brs_month.uiic_office_code) or
(current_user.user_type == "admin") %}

<div class="container is-size-8 is-centered">

    <table class="table is-fullwidth is-bordered">
        <thead>
            <tr>
                <th class="has-text-centered">Regional office code</th>
                <th class="has-text-centered">Operating office code</th>
                <th class="has-text-centered">Financial year</th>
                <th class="has-text-centered">Month</th>
            </tr>
        </thead>
        <tbody>
            <tr class="has-text-centered">
                <td>{{ brs_month.uiic_regional_code }}</td>
                <td>{{ brs_month.uiic_office_code }}</td>
                <td>{{ brs_month.financial_year }}</td>
                <td>{{ brs_month.month }}</td>
            </tr>
        </tbody>
    </table>
    {% set brs_types = [
    ("cash", "Cash", cash_brs),
    ("cheque", "Cheque", cheque_brs),
    ("pg", "Payment Gateway", pg_brs),
    ("pos", "POS", pos_brs),
    ("bbps", "BBPS", bbps_brs),
    ("dqr", "DQR", dqr_brs),
    ("local_collection", "Local Collection", local_collection_brs)
    ] %}

    <table class="table is-fullwidth is-bordered">
        <thead>
            <tr>
                <th></th>
                <th></th>
                {% for key, label, brs in brs_types %}
                <th class="has-text-centered is-vcentered">{% if brs %} {{ label }} {% endif %}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            <tr>
                <th class="is-vcentered">BRS bank</th>
                <td></td>
                {% for key, label, brs in brs_types %}
                <td class="has-text-centered is-vcentered">{{ brs_month[key ~ "_bank"] if brs }}</td>
                {% endfor %}
            </tr>

            <tr>
                <td colspan="{{ 2 + brs_types|length }}" class="has-text-weight-bold">
                    Summary of General Ledger
                </td>
            </tr>

            {% set rows = [
            ("Opening balance as per GL", "int_opening_balance", "previous", true),
            ("Add: Opening On hand", "int_opening_on_hand", "previous", false),
            ("Add: Collections during the month", "int_transactions", "current_month", false),
            ("Less: Cancellations / cheque dishonours during the month", "int_cancellations", "current_month", false),
            ("Balance before fund transfer", "balance_before_fund_transfer", "current", true),
            ("Less: Fund transfer", "int_fund_transfer", "current_month", false),
            ("Less: Bank charges", "int_bank_charges", "current_month", false),
            ("Less: Closing On hand", "int_closing_on_hand", "current", false),
            ("Closing balance as per GL", "int_closing_balance", "current", true),
            ] %}

            {% for label, field, date_mode, bold in rows %}
            <tr class="{% if bold %}has-text-weight-bold{% endif %}">
                <td>{{ label }}</td>
                <td>{{ brs_month.month | datetime_format("%B-%Y", date_mode) }}</td>
                {% for key, _, brs in brs_types %}
                <td class="has-text-right">
                    {% if brs %}
                    {% if field == "balance_before_fund_transfer" %}
                    {{ ((brs.int_opening_balance + brs.int_opening_on_hand +
                    brs.int_transactions - brs.int_cancellations) | indian_number_format) }}
                    {% else %}
                    {{ brs[field] | indian_number_format }}

                    {% endif %}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}

            <tr>
                <td colspan="{{ 2 + brs_types|length }}" class="has-text-weight-bold">
                    Bank reconciliation statement
                </td>
            </tr>

            {% set brs_rows = [
            ("Closing balance as per GL", "int_closing_balance"),
            ("Less: Deposited but not credited", "int_deposited_not_credited"),
            ("Less: Short credit entries", "int_short_credited"),
            ("Add: Excess credit entries", "int_excess_credited"),
            ("Closing balance as per bank statement", "int_balance_as_per_bank"),
            ] %}

            {% for label, field in brs_rows %}
            <tr class="{% if 'Closing balance' in label %}has-text-weight-bold{% endif %}">
                <td>{{ label }}</td>
                <td>{{ brs_month.month | datetime_format("%B-%Y", "current") }}</td>
                {% for key, _, brs in brs_types %}
                <td class="has-text-right">
                    {% if brs %}
                    {{ brs[field] | indian_number_format }}

                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% if display == "pdf" %}
<table class="mt-5 table is-centered is-fullwidth is-bordered">
    <thead>
        <tr>
            <th class="has-text-centered">Accounts officer</th>
            <th class="has-text-centered">Accounts incharge</th>
            <th class="has-text-centered">Regional accountant</th>
            <th class="has-text-centered">Regional manager / incharge</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="is-invisible">Dummy text for height padding</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </tbody>
</table>

{% endif %}

{% if display == "html" %}
<div class="mt-5 has-text-centered">
    <a class="button is-link" href="{{ url_for('brs.upload_brs', brs_key = brs_month.id) }}">Go back</a>
    <a class="button is-link" href="{{ url_for('brs.view_consolidated_brs', brs_key = brs_month.id, display='pdf') }}"
        target="_blank">
        Print as PDF</a>
</div>
{% endif %}
{% endif %}
{% endblock content %}
